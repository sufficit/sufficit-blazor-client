@page "/signalrqstatus/{extension}"
@inherits Components.SignalRQStatusComponent

<MudGrid Spacing="0">    

    <MudText Class="pa-4" Align="Align.Left" Typo="Typo.h6">Fila de espera: @Extension</MudText>
    <MudDivider />

    @if(@AMIQueue != null)
    {
        <MudGrid Spacing="1" Class="ma-0 pa-4">
            <MudItem xs="12" sm="6" md="4">
                <MudField Label="Última atualização" Variant="Variant.Text">@AMIQueue.Updated</MudField>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudField Label="Estratégia" Variant="Variant.Text">@AMIQueue.Strategy</MudField>
            </MudItem>
        </MudGrid>
        <MudGrid Spacing="1" Class="ma-0 pa-4">
            <MudItem xs="12" sm="6" md="2">
                <MudField Label="Máximo simultâneas" Variant="Variant.Outlined" Style="text-align: center;">@AMIQueue.Max</MudField>
            </MudItem>
            <MudItem xs="12" sm="6" md="2">
                <MudField Label="Chamadas" Variant="Variant.Outlined" Style="text-align: center;">@AMIQueue.Calls</MudField>
            </MudItem>
            <MudItem xs="12" sm="6" md="2">
                <MudField Label="Tempo de espera" Variant="Variant.Outlined" Style="text-align: center;">@AMIQueue.HoldTime</MudField>
            </MudItem>
            <MudItem xs="12" sm="6" md="2">
                <MudField Label="Completadas" Variant="Variant.Outlined" Style="text-align: center;">@AMIQueue.Completed</MudField>
            </MudItem>
            <MudItem xs="12" sm="6" md="2">
                <MudField Label="Abandonadas" Variant="Variant.Outlined" Style="text-align: center;">@AMIQueue.Abandoned</MudField>
            </MudItem>
            <MudItem xs="12" sm="6" md="2">
                <MudField Label="Tempo Falado" Variant="Variant.Outlined" Style="text-align: center;">@AMIQueue.TalkTime</MudField>
            </MudItem>
        </MudGrid>
        <MudDivider />
        <MudTable Items="@AMIQueue.Agents" Hover="true" SortLabel="Ordenar" FixedHeader="true" Height="100%" Style="width: 100%">
            <ToolBarContent>
                <MudText Align="Align.Left" Typo="Typo.h6">Estado de extensões 
                    @if (IsConnected)
                    {
                        <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.DoNotDisturb" Color="Color.Error" OnClick="DisposeConnection"></MudIconButton>
                    }
                    <MudText Align="Align.Left" Typo="Typo.subtitle1">( @hubConnection?.State ) :: (@AMIQueue.Events)</MudText>
                </MudText>            
                <MudSpacer />
                <MudTextField Disabled="!IsConnected" Value="filterInput" ValueChanged="@((string __e) => OnSetFilter(__e))"  Placeholder="Filtro (Extensão | Ip)" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
            </ToolBarContent>
            <HeaderContent>
                <MudTh><MudTableSortLabel InitialDirection="SortDirection.Ascending" SortBy="new Func<QueueAgentStatus, object>(x=>x.Title)">Titulo</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<QueueAgentStatus, object>(x=>x.Membership)">Tipo</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<QueueAgentStatus, object>(x=>x.Penalty)">Penalidade</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<QueueAgentStatus, object>(x=>x.CallsTaken)">Chamadas</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<QueueAgentStatus, object>(x=>x.LastCall)">Última</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<QueueAgentStatus, object>(x=>x.Status)">Estado</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<QueueAgentStatus, object>(x=>x.Paused)">Em Pausa</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<QueueAgentStatus, object>(x=>x.InCall)">Atendendo</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<QueueAgentStatus, object>(x=>x.PausedReason)">Motivo</MudTableSortLabel></MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Titulo">@context.Title</MudTd>
                <MudTd DataLabel="Tipo">@context.Membership</MudTd>
                <MudTd DataLabel="Penalidade">@context.Penalty</MudTd>
                <MudTd DataLabel="Chamadas">@context.CallsTaken</MudTd>
                <MudTd DataLabel="Última">@context.LastCall</MudTd>
                <MudTd DataLabel="Estado">@context.Status</MudTd>
                <MudTd DataLabel="Em Pausa">@context.Paused</MudTd>
                <MudTd DataLabel="Atendendo">@context.InCall</MudTd>
                <MudTd DataLabel="Motivo">@context.PausedReason</MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager PageSizeOptions="new int[]{50, 100}" />
            </PagerContent>
        </MudTable>
   }
</MudGrid>