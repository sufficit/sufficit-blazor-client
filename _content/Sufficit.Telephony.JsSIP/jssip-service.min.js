export function BrowserOutputSelectSupport(){return!("sinkId"in HTMLMediaElement.prototype)}export var WebPhone,DotNetObjectReference,AccountReference;let t="media-player-self",i="audio-player-remote";export const GetStatus=function(){return WebPhone.status},Reference=async function(n,t,i){if(DotNetObjectReference=t,AccountReference=i,!window.JsSIP){const t=document.getElementById("jssip");t?await window.JsSIPLoading:window.JsSIPLoading=await new Promise(t=>{console.debug("resolving: {0}",n),CreateScriptTag(n,()=>t(window.JsSIP),document.body)})}await t.invokeMethodAsync("onDependenciesLoaded",window.JsSIP)},CreateScriptTag=function(n,t,i){var r=document.createElement("script");r.id="jssip";r.src=n;r.onload=t;r.onreadystatechange=t;i.appendChild(r)},onJsSIPLoaded=function(t){let i=[];t.sockets.forEach(function(n){let t=new JsSIP.WebSocketInterface(n);i.push(t)});t.sockets=i;WebPhone=new JsSIP.UA(t);window.WebPhone=WebPhone;WebPhone.on("connected",n.bind(this,"onConnected"));WebPhone.on("disconnected",n.bind(this,"onDisconnected"));WebPhone.on("newMessage",n.bind(this,"onNewMessage"));WebPhone.on("registered",n.bind(this,"NotifyRegistered"));WebPhone.on("unregistered",n.bind(this,"NotifyUnregistered"));WebPhone.on("registrationFailed",n.bind(this,"NotifyRegistrationFailed"));WebPhone.on("ringing",n.bind(this,"onRinging"));WebPhone.on("ack",n.bind(this,"onAck"));WebPhone.on("newRTCSession",n.bind(this,"onNewRTCSession"));WebPhone.start()};const n=function(n,t){switch(n){case"onNewRTCSession":t=t.session;t.toJSON=r;break;case"onDisconnected":console.debug(t);break;case"NotifyRegistered":case"NotifyUnregistered":case"NotifyRegistrationFailed":return AccountReference.invokeMethodAsync(n,t),undefined}DotNetObjectReference.invokeMethodAsync(n,t)},r=function(){let t=["id","direction","status"];var n={};for(const i of t)n[i]=this[i];return n};export const TestDevices=async function(n){console.debug("testing devices request: {0}",n);let t=!1;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices.getUserMedia;const r=new Promise(function(t,i){navigator.getUserMedia(n,t,i)});let i;const u=await r.then(()=>t=!0).catch(n=>i=`(${n.code}) ${n.name} => ${n.message}`);return console.debug("response: {0}",u),{request:n,success:t,message:i}},MediaDeviceUpdate=async function(n,i){console.debug(`MediaDeviceUpdate => ${n} :: ${i}`);switch(n){case"audiooutput":AttachSinkId(i);break;case"videoinput":{let n=document.getElementById(t);n||(n=document.createElement("video"),n.id=t,document.body.appendChild(n));const r=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:i}}});"srcObject"in n?n.srcObject=r:n.src=URL.createObjectURL(r);break}}};export const AttachSinkId=function(n){const t=document.getElementById(i);typeof t.sinkId!="undefined"?t.setSinkId(n).then(()=>{console.log(`Success, audio output device attached: ${n}`)}).catch(n=>{let t=n;n.name==="SecurityError"&&(t=`You need to use HTTPS for selecting audio output device: ${n}`);console.error(t);audioOutputSelect.selectedIndex=0}):console.warn("Browser does not support output device selection.")},MediaDevices=async function(){return!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices?(console.warn("enumerateDevices() not supported."),undefined):await new Promise(function(n){navigator.mediaDevices.enumerateDevices().then(n).catch(function(n){console.error(n.name+": "+n.message)})})};